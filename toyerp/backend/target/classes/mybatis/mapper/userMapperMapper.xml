<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.toyerp.domain.user.mapper.UserMapper">
    
    <!-- 사용자 조회 -->
    <select id="findByUsername" parameterType="String" resultType="com.example.toyerp.domain.user.vo.UserVO">
        SELECT id, username, password, created_at as createdAt, status, 
               employee_id as employeeId, activated_at as activatedAt, 
               email, email_verified as emailVerified
        FROM users 
        WHERE username = #{username}
    </select>
    

    <select id="findByEmail" parameterType="string" resultType="com.example.toyerp.domain.user.vo.UserVO">
        SELECT id, username, password, email, email_verified
        FROM users
        WHERE email = #{email}
    </select>


    
    <!-- 사용자 등록 (이메일 포함) -->
    <insert id="insertUser" parameterType="com.example.toyerp.domain.user.vo.UserVO">
        INSERT INTO users (
            username, 
            password, 
            status,
            <if test="email != null">email,</if>
            <if test="emailVerified != null">email_verified,</if>
            created_at
        ) VALUES (
            #{username}, 
            #{password}, 
            #{status},
            <if test="email != null">#{email},</if>
            <if test="emailVerified != null">#{emailVerified},</if>
            NOW()
        )
    </insert>
    
    <!-- 이메일 인증 상태 업데이트 -->
    <update id="updateEmailVerified" parameterType="String">
        UPDATE users 
        SET email_verified = 1 
        WHERE email = #{email}
    </update>
    
</mapper>